---
layout: post
title: "gke"
---

I've been working with DigitalOcean, Heroku and AWS for some years now.
Recently, I decided to give GCE (Google Compute Engine), and, more specifically,
GKE (Google Container Engine) a try. In this post I intend to show a few
traits and quick wins I learned and things I struggled with.

## SSL and LoadBalancers

On AWS, we can define a Kubernetes service with a SSL certificate using
annotations, something like this:

```yaml
apiVersion: v1
kind: Service
metadata:
  name: myapp
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-ssl-cert: arn:aws:iam::123:server-certificate/my_certificate
    service.beta.kubernetes.io/aws-load-balancer-backend-protocol: http
    service.beta.kubernetes.io/aws-load-balancer-ssl-ports: https
spec:
  ports:
  - name: https
    port: 443
    targetPort: 8080
  selector:
    app: myapp
  type: LoadBalancer
```

This will create an Elastic LoadBalancer with the given certificate on the port
443.

I looked into doing the same thing on GKE, but, as it turns out, GKE
uses Ingresses to setup SSL, turning it into a Load Balancer.

You can even have multiple services in the same load balancer and each one
will have it's own health check (more on that later). It's awesome.

I ended up with something like this:

```yaml

apiVersion: v1
kind: Service
metadata:
  name: app
spec:
  ports:
  - name: http
    port: 80
    protocol: TCP
    targetPort: 80
  selector:
    app: app
  sessionAffinity: None
  type: NodePort
---
apiVersion: v1
kind: Service
metadata:
  name: api
spec:
  ports:
  - name: http
    port: 80
    protocol: TCP
    targetPort: 8080
  selector:
    app: app
  sessionAffinity: None
  type: NodePort
```
